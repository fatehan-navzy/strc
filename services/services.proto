syntax = "proto3";

package com.navzy.services;

option go_package = "github.com/fatehan-navzy/strc/services";

import "services/repo.proto";
import "devices/devices.proto";
import "google/protobuf/timestamp.proto";

option java_package = "com.fatehan.navzy.services";
option java_multiple_files = true;

service NavzyService {
  rpc PacketIndex(PacketRequest) returns (PacketResponse);
  rpc DeviceCreate(com.navzy.devices.Device) returns (com.navzy.devices.Device);
  rpc DeviceStatusIndex(DeviceStatusRequest) returns (DeviceStatusResponse);
  rpc DeviceImport(DeviceImportRequest) returns (DeviceImportResponse);
  rpc DeviceExport(DeviceExportRequest) returns (DeviceExportResponse);
}

message DeviceExportResponse {
  string encoded = 1 [json_name = 'encoded'];
}

message DeviceExportRequest {
  repeated string dynamic_keys = 1 [json_name = 'dynamic_keys'];
}

message DeviceImportRequest {
  string encoded = 1 [json_name = 'encoded'];
}

message DeviceImportResponse {
  repeated com.navzy.devices.Device devices = 1 [json_name = 'devices'];
}

message DeviceStatusRequest {
  repeated string dynamic_keys = 1 [json_name = 'dynamic_key'];
}

message DeviceStatusResponse {
  uint32 cost = 1 [json_name = 'cost'];
  uint32 records = 2 [json_name = 'records'];
  repeated DeviceStatus items = 3 [json_name = 'items'];
}

message PacketRequest {
  message DevicePacketRequest {
    TimeRange from = 1 [json_name = 'from'];
    string dynamic_key = 2 [json_name = 'dynamic_key'];
  }
  repeated DevicePacketRequest items = 1 [json_name = 'items'];
}

message PacketResponse {
  message DevicePacketResponse {
    string dynamic_key = 1;
    google.protobuf.Timestamp received_at = 2;
    bytes packets = 3;
  }

  repeated DevicePacketResponse items = 1 [json_name = 'items'];
}