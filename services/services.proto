syntax = "proto3";

package com.navzy.services;

option go_package = "github.com/fatehan-navzy/strc/services";

import "services/repo.proto";
import "devices/devices.proto";
import "google/protobuf/timestamp.proto";

option java_package = "com.fatehan.navzy.services";
option java_multiple_files = true;

service NavzyService {
  rpc PacketIndex(PacketRequest) returns (PacketResponse);
  rpc DeviceCreate(com.navzy.devices.Device) returns (com.navzy.devices.Device);
  rpc DeviceStatusIndex(DeviceStatusRequest) returns (DeviceStatusResponse);
  rpc DeviceImport(DeviceImportRequest) returns (DeviceImportResponse);
  rpc DeviceExport(DeviceExportRequest) returns (DeviceExportResponse);
}

message DeviceExportResponse {
  string encoded = 1;
}

message DeviceExportRequest {
  repeated string dynamic_keys = 1;
}

message DeviceImportRequest {
  string encoded = 1;
}

message DeviceImportResponse {
  repeated com.navzy.devices.Device devices = 1;
}

message DeviceStatusRequest {
  repeated string dynamic_keys = 1;
}

message DeviceStatusResponse {
  uint32 cost = 1;
  uint32 records = 2;
  repeated DeviceStatus list = 3;
}

message PacketRequest {
  message DevicePacketRequest {
    TimeRange from = 1 [json_name = 'from'];
    string dynamic_key = 2 [json_name = 'dynamic_key'];
  }
  repeated DevicePacketRequest list = 1 [json_name = 'list'];
}

message PacketResponse {
  message DevicePacketResponse {
    string dynamic_key = 1;
    google.protobuf.Timestamp received_at = 2;
    bytes packets = 3;
  }

  repeated DevicePacketResponse list = 1 [json_name = 'list'];
}